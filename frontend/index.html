<!DOCTYPE html>
<html lang="az">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <title>MaliAI - Smart Business Finance</title>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap");

        * {
            -webkit-tap-highlight-color: transparent;
            font-family: "Inter", sans-serif;
        }

        body {
            overscroll-behavior: none;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .gradient-bg-strong {
            background: linear-gradient(135deg, #5b6ff5 0%, #8b46ff 50%, #ff4dc6 100%);
        }

        .glass-light {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 18px 45px rgba(15, 23, 42, 0.15);
        }

        .glass-dark {
            background: rgba(15, 23, 42, 0.95);
            box-shadow: 0 18px 45px rgba(0, 0, 0, 0.7);
        }

        .animate-floating {
            animation: floating 3s ease-in-out infinite;
        }

        @keyframes floating {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .animate-scan-line {
            animation: scanline 2s ease-in-out infinite;
        }

        @keyframes scanline {

            0%,
            100% {
                transform: translateY(-140%);
                opacity: 0;
            }

            50% {
                transform: translateY(40%);
                opacity: 1;
            }
        }

        .scale-in {
            animation: scaleIn 0.25s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0.95);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .backdrop-blur-strong {
            backdrop-filter: blur(18px);
        }
    </style>
</head>

<body class="bg-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const ALLOWED_VIEWS = ["splash", "login", "register", "dashboard"];

        const getInitialView = () => {
            const hash = window.location.hash.replace("#", "");
            if (ALLOWED_VIEWS.includes(hash)) return hash;
            return "splash";
        };

        const getInitialTheme = () => {
            if (typeof window === "undefined") return "dark";
            const saved = localStorage.getItem("maliai_theme");
            if (saved === "light" || saved === "dark") return saved;
            return "dark";
        };

        const App = () => {
            const [view, setView] = useState(getInitialView);
            const [activeTab, setActiveTab] = useState("dashboard");
            const [theme, setTheme] = useState(getInitialTheme);
            const [user, setUser] = useState(null);

            const [receipts, setReceipts] = useState([]);
            const [latestReceipt, setLatestReceipt] = useState(null);
            const [flowStep, setFlowStep] = useState(null); // "analyzing" | "categories" | "export" | null
            const [showResult, setShowResult] = useState(false);

            const [chatMessages, setChatMessages] = useState([]);
            const [chatInput, setChatInput] = useState("");
            const chatEndRef = useRef(null);
            const fileInputRef = useRef(null);

            // --- Splash -> Login ---
            useEffect(() => {
                if (view === "splash") {
                    const t = setTimeout(() => setView("login"), 2000);
                    return () => clearTimeout(t);
                }
            }, [view]);

            // --- Chat scroll ---
            useEffect(() => {
                chatEndRef.current?.scrollIntoView({ behavior: "smooth" });
            }, [chatMessages]);

            // --- History sync ---
            useEffect(() => {
                if (!view) return;
                const hash = `#${view}`;
                if (window.location.hash !== hash) {
                    window.history.pushState({ view }, "", hash);
                } else {
                    window.history.replaceState({ view }, "", hash);
                }
            }, [view]);

            useEffect(() => {
                const handlePopState = (event) => {
                    const stateView = event.state?.view;
                    if (ALLOWED_VIEWS.includes(stateView)) {
                        setView(stateView);
                    } else {
                        const hashView = window.location.hash.replace("#", "");
                        if (ALLOWED_VIEWS.includes(hashView)) setView(hashView);
                    }
                };
                window.addEventListener("popstate", handlePopState);
                return () => window.removeEventListener("popstate", handlePopState);
            }, []);

            // --- Theme handling ---
            useEffect(() => {
                document.body.className =
                    theme === "dark" ? "bg-slate-900" : "bg-slate-50";
                localStorage.setItem("maliai_theme", theme);
            }, [theme]);

            const toggleTheme = () => {
                setTheme((prev) => (prev === "dark" ? "light" : "dark"));
            };

            const isDark = theme === "dark";

            // --- Auth forms ---
            const handleLogin = (e) => {
                e.preventDefault();
                const formData = new FormData(e.target);
                setUser({
                    name: formData.get("name") || "istifad…ô√ßi",
                    email: formData.get("email") || "",
                    business: formData.get("business") || "Biznesiniz",
                });
                setView("dashboard");
            };

            const handleRegister = (e) => {
                e.preventDefault();
                setView("login");
            };

            // --- Receipts & scanning flow ---
            const handleFileUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (ev) => {
                    const categories = [
                        "M…ôhsullar",
                        "Xidm…ôtl…ôr",
                        "∆èm…ôk haqqƒ±",
                        "ƒ∞car…ô",
                        "Kommunal x…ôrcl…ôr",
                        "N…ôqliyyat",
                        "Ofis l…ôvazimatlarƒ±",
                        "Marketing",
                    ];
                    const newReceipt = {
                        id: Date.now(),
                        image: ev.target.result,
                        date: new Date().toISOString(),
                        vendor: "T…ôchizat√ßƒ± " + Math.floor(Math.random() * 100),
                        amount: (Math.random() * 500 + 50).toFixed(2),
                        category: categories[Math.floor(Math.random() * categories.length)],
                        confidence: 90 + Math.floor(Math.random() * 10),
                    };

                    setLatestReceipt(newReceipt);
                    setReceipts((prev) => [newReceipt, ...prev]);

                    // ardƒ±cƒ±l p…ônc…ôr…ô axƒ±nƒ±
                    setFlowStep("analyzing");
                    setShowResult(false);

                    // Buradakƒ± vaxtlarƒ± d…ôyi≈ü…ôr…ôk h…ôr p…ônc…ôr…ônin m√ºdd…ôtini idar…ô ed…ô bil…ôrs…ôn
                    setTimeout(() => setFlowStep("categories"), 1600); // 1-ci p…ônc…ôr…ô m√ºdd…ôti
                    setTimeout(() => setFlowStep("export"), 3200);     // 2-ci p…ônc…ôr…ô m√ºdd…ôti
                    setTimeout(() => {
                        setFlowStep(null);
                        setShowResult(true);                            // 3-c√º p…ônc…ôr…ô bitir, n…ôtic…ô kartƒ±
                    }, 5000);
                };
                reader.readAsDataURL(file);
            };

            const totalExpense = receipts.reduce(
                (acc, r) => acc + parseFloat(r.amount),
                0
            );

            // --- Chat ---
            const sendMessage = async () => {
                if (!chatInput.trim()) return;

                const userMessage = chatInput.trim();
                const newMessages = [
                    ...chatMessages,
                    { role: "user", content: userMessage },
                ];
                setChatMessages(newMessages);
                setChatInput("");

                // Daha real maliyy…ô m…ôsl…ôh…ôt√ßi konteksti
                const categoriesText =
                    receipts.length > 0
                        ? Array.from(new Set(receipts.map((r) => r.category))).join(", ")
                        : "h…ôl…ô he√ß bir kateqoriya yoxdur";

                const financialContext = `
S…ôn Az…ôrbaycan dilind…ô danƒ±≈üan pe≈ü…ôkar AI maliyy…ô m…ôsl…ôh…ôt√ßisis…ôn. 
S…ônin …ôsas m…ôqs…ôdin istifad…ô√ßinin y√ºkl…ôdiyi q…ôbzl…ôr…ô v…ô x…ôrcl…ôr strukturuna …ôsaslanaraq praktik, detallƒ± v…ô biznes y√∂n√ºml√º t√∂vsiy…ôl…ôr verm…ôkdir.

M√∂vcud m…ôlumatlar:
- Biznesin adƒ±: ${user?.business || "nam…ôlum"}
- Cari ay √ºzr…ô √ºmumi x…ôrcl…ôr: ${totalExpense.toFixed(2)} ‚Çº
- Qeydiyyata alƒ±nmƒ±≈ü q…ôbzl…ôrin sayƒ±: ${receipts.length}
- X…ôrc kateqoriyalarƒ±: ${categoriesText}

T√∂vsiy…ôl…ôrind…ô a≈üaƒüƒ±dakƒ± m…ôqamlarƒ± n…ôz…ôr…ô al:
1. X…ôrcl…ôri kateqoriyalar √ºzr…ô analiz et (m…ôs…ôl…ôn, icar…ô, …ôm…ôk haqqƒ±, kommunal, n…ôqliyyat, ofis l…ôvazimatlarƒ± v…ô s.) v…ô harada optimalla≈üdƒ±rma imkanƒ± olduƒüunu izah et.
2. Naƒüd pul axƒ±nƒ±, b√ºdc…ô planlamasƒ±, q…ôna…ôt potensialƒ± v…ô riskl…ôr bar…ôd…ô konkret, addƒ±m-addƒ±m m…ôsl…ôh…ôtl…ôr ver.
3. Lazƒ±m g…ôldikd…ô kredit g√∂t√ºr√ºlm…ôsi, √∂d…ôni≈ü qrafiki v…ô borc y√ºk√ºn√ºn idar…ô olunmasƒ± bar…ôd…ô d…ô t√∂vsiy…ôl…ôr ver.
4. H…ôddind…ôn artƒ±q texniki terminl…ôrd…ôn qa√ß, daha √ßox sahibkar √º√ß√ºn ba≈üa d√º≈ü√ºl…ôn, aydƒ±n dild…ô yaz.
5. Cavabƒ±nƒ± strukturla≈üdƒ±r: qƒ±sa giri≈ü, sonra madd…ôl…ôrl…ô …ôsas t√∂vsiy…ôl…ôr, sonda is…ô yekun n…ôtic…ô v…ô n√∂vb…ôti addƒ±mlar.

H…ômi≈ü…ô yalnƒ±z Az…ôrbaycan dilind…ô cavab ver v…ô istifad…ô√ßinin son sualƒ±nƒ± bu kontekst…ô uyƒüun ≈ü…ôkild…ô cavablandƒ±r.
        `;

                // Backend URL se√ßimi
                const BASE_URL =
                    window.location.hostname === "localhost" ||
                        window.location.hostname === "127.0.0.1"
                        ? "http://localhost:3000"
                        : "https://maliai-backend.onrender.com";

                try {
                    const response = await fetch(`${BASE_URL}/api/chat`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            model: "gpt-4o-mini",
                            messages: [
                                { role: "system", content: financialContext },
                                ...newMessages.map((m) => ({
                                    role: m.role,
                                    content: m.content,
                                })),
                            ],
                            temperature: 0.7,
                            max_tokens: 500,
                        }),
                    });

                    if (!response.ok) {
                        console.error("Backend HTTP error:", response.status, response.statusText);
                        throw new Error(`HTTP ${response.status}`);
                    }

                    const data = await response.json();
                    console.log("Backend response:", data);

                    const aiResponse =
                        data?.choices?.[0]?.message?.content ||
                        data?.data?.choices?.[0]?.message?.content ||
                        data?.reply ||
                        data?.message ||
                        data?.answer ||
                        "√úzr ist…ôyir…ôm, cavab alƒ±na bilm…ôdi.";

                    setChatMessages((prev) => [
                        ...prev,
                        { role: "assistant", content: aiResponse },
                    ]);
                } catch (error) {
                    console.error("Chat request failed:", error);
                    setChatMessages((prev) => [
                        ...prev,
                        {
                            role: "assistant",
                            content:
                                "√úzr ist…ôyir…ôm, serverl…ô …ôlaq…ô saxlanƒ±lark…ôn x…ôta ba≈ü verdi. Bir az sonra yenid…ôn c…ôhd ed…ô bil…ôrsiniz.",
                        },
                    ]);
                }
            };

            // ---------- SPLASH ----------
            if (view === "splash") {
                return (
                    <div className="h-screen gradient-bg flex items-center justify-center relative overflow-hidden">
                        <div className="absolute inset-0 opacity-20">
                            <div className="absolute top-20 left-10 w-32 h-32 bg-white rounded-full blur-3xl animate-floating"></div>
                            <div
                                className="absolute bottom-20 right-10 w-40 h-40 bg-purple-300 rounded-full blur-3xl animate-floating"
                                style={{ animationDelay: "0.8s" }}
                            ></div>
                        </div>
                        <div className="text-center z-10 scale-in">
                            <div className="w-24 h-24 bg-white rounded-3xl mx-auto mb-6 flex items-center justify-center shadow-2xl animate-floating">
                                <span className="text-5xl">üíº</span>
                            </div>
                            <h1 className="text-5xl font-black text-white mb-2">
                                MaliAI
                            </h1>
                            <p className="text-white/80 text-lg font-medium">
                                Aƒüƒ±llƒ± Biznes Maliyy…ôsi
                            </p>
                        </div>
                    </div>
                );
            }

            // ---------- LOGIN ----------
            if (view === "login") {
                return (
                    <div
                        className={`min-h-screen flex items-center justify-center p-6 relative overflow-hidden ${isDark ? "bg-slate-900" : "bg-slate-50"
                            }`}
                    >
                        <div className="absolute inset-0 opacity-10 pointer-events-none">
                            <div className="absolute top-0 left-0 w-64 h-64 bg-purple-400 rounded-full blur-3xl"></div>
                            <div className="absolute bottom-0 right-0 w-72 h-72 bg-indigo-400 rounded-full blur-3xl"></div>
                        </div>

                        <div className="w-full max-w-md z-10 scale-in">
                            <div className="text-center mb-8">
                                <div className="w-20 h-20 bg-white rounded-3xl mx-auto mb-4 flex items-center justify-center shadow-2xl">
                                    <span className="text-4xl">üíº</span>
                                </div>
                                <h1 className="text-4xl font-black text-slate-900 mb-2">
                                    MaliAI
                                </h1>
                                <p className="text-slate-600 text-lg">
                                    AI il…ô biznes x…ôrcl…ôrinizi idar…ô edin
                                </p>
                            </div>

                            <div
                                className={`${isDark ? "glass-dark text-white" : "glass-light text-slate-900"
                                    } rounded-3xl p-8`}
                            >
                                <form onSubmit={handleLogin} className="space-y-4">
                                    <div>
                                        <input
                                            name="name"
                                            required
                                            placeholder="Adƒ±nƒ±z v…ô Soyadƒ±nƒ±z"
                                            className="w-full px-5 py-4 rounded-2xl bg-white border border-slate-200 focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-800 placeholder:text-slate-400"
                                        />
                                    </div>
                                    <div>
                                        <input
                                            name="email"
                                            type="email"
                                            required
                                            placeholder="Email √ºnvanƒ±nƒ±z"
                                            className="w-full px-5 py-4 rounded-2xl bg-white border border-slate-200 focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-800 placeholder:text-slate-400"
                                        />
                                    </div>
                                    <div>
                                        <input
                                            name="business"
                                            required
                                            placeholder="Biznesinizin adƒ±"
                                            className="w-full px-5 py-4 rounded-2xl bg-white border border-slate-200 focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-800 placeholder:text-slate-400"
                                        />
                                    </div>
                                    <button
                                        type="submit"
                                        className="w-full py-4 rounded-2xl gradient-bg-strong text-white font-bold text-lg shadow-xl hover:shadow-2xl active:scale-95 transition-all"
                                    >
                                        Giri≈ü
                                    </button>
                                </form>

                                <div className="mt-4 text-center text-sm">
                                    Hesabƒ±nƒ±z yoxdur?{" "}
                                    <button
                                        type="button"
                                        onClick={() => setView("register")}
                                        className="font-semibold underline"
                                    >
                                        Qeydiyyatdan ke√ßin
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ---------- REGISTER ----------
            if (view === "register") {
                return (
                    <div
                        className={`min-h-screen flex items-center justify-center p-6 relative overflow-hidden ${isDark ? "bg-slate-900" : "bg-slate-50"
                            }`}
                    >
                        <div className="absolute inset-0 opacity-10 pointer-events-none">
                            <div className="absolute top-0 left-0 w-64 h-64 bg-purple-400 rounded-full blur-3xl"></div>
                            <div className="absolute bottom-0 right-0 w-72 h-72 bg-indigo-400 rounded-full blur-3xl"></div>
                        </div>

                        <div className="w-full max-w-md z-10 scale-in">
                            <div className="text-center mb-8">
                                <div className="w-20 h-20 bg-white rounded-3xl mx-auto mb-4 flex items-center justify-center shadow-2xl">
                                    <span className="text-4xl">üìù</span>
                                </div>
                                <h1 className="text-4xl font-black text-slate-900 mb-2">
                                    Qeydiyyat
                                </h1>
                                <p className="text-slate-600 text-lg">
                                    MaliAI hesabƒ±nƒ±zƒ± yaradƒ±n
                                </p>
                            </div>

                            <div
                                className={`${isDark ? "glass-dark text-white" : "glass-light text-slate-900"
                                    } rounded-3xl p-8`}
                            >
                                <form onSubmit={handleRegister} className="space-y-4">
                                    <div>
                                        <input
                                            name="name"
                                            required
                                            placeholder="Adƒ±nƒ±z v…ô Soyadƒ±nƒ±z"
                                            className="w-full px-5 py-4 rounded-2xl bg-white border border-slate-200 focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-800 placeholder:text-slate-400"
                                        />
                                    </div>
                                    <div>
                                        <input
                                            name="email"
                                            type="email"
                                            required
                                            placeholder="Email √ºnvanƒ±nƒ±z"
                                            className="w-full px-5 py-4 rounded-2xl bg-white border border-slate-200 focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-800 placeholder:text-slate-400"
                                        />
                                    </div>
                                    <div>
                                        <input
                                            name="business"
                                            required
                                            placeholder="Biznesinizin adƒ±"
                                            className="w-full px-5 py-4 rounded-2xl bg-white border border-slate-200 focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-800 placeholder:text-slate-400"
                                        />
                                    </div>
                                    <div>
                                        <input
                                            name="password"
                                            type="password"
                                            placeholder="≈ûifr…ô (placeholder)"
                                            className="w-full px-5 py-4 rounded-2xl bg-white border border-slate-200 focus:outline-none focus:ring-2 focus:ring-purple-500 text-slate-800 placeholder:text-slate-400"
                                        />
                                    </div>
                                    <button
                                        type="submit"
                                        className="w-full py-4 rounded-2xl gradient-bg-strong text-white font-bold text-lg shadow-xl hover:shadow-2xl active:scale-95 transition-all"
                                    >
                                        Qeydiyyatƒ± tamamla
                                    </button>
                                </form>

                                <div className="mt-4 text-center text-sm">
                                    Artƒ±q hesabƒ±nƒ±z var?{" "}
                                    <button
                                        type="button"
                                        onClick={() => setView("login")}
                                        className="font-semibold underline"
                                    >
                                        Giri≈ü et
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ---------- SCAN FLOW WINDOWS ----------
            if (flowStep === "analyzing") {
                return (
                    <div
                        className="h-screen bg-slate-950 flex flex-col items-center justify-center text-center px-6"
                    >
                        <div className="scale-in max-w-md w-full">
                            <div className="mx-auto w-56 h-56 border-4 border-purple-500/60 rounded-3xl flex items-center justify-center relative">
                                <div className="absolute inset-2 rounded-2xl border border-purple-400/40"></div>
                                <div className="absolute inset-4 rounded-2xl border border-purple-400/30 overflow-hidden">
                                    <div className="w-full h-1 bg-gradient-to-r from-transparent via-purple-400 to-transparent animate-scan-line"></div>
                                </div>
                                <div className="relative z-10 w-24 h-24 rounded-3xl bg-slate-900 flex items-center justify-center shadow-2xl">
                                    <span className="text-5xl">ü§ñ</span>
                                </div>
                            </div>

                            <h2 className="text-3xl font-extrabold text-white mt-10 mb-3">
                                AI Analiz Edir
                            </h2>
                            <p className="text-purple-200 max-w-sm mx-auto text-sm">
                                Q…ôbz skan edilir, m…ôlumatlar √ßƒ±xarƒ±lƒ±r v…ô x…ôrcl…ôr avtomatik
                                kateqoriyala≈üdƒ±rƒ±lƒ±r...
                            </p>
                        </div>
                    </div>
                );
            }

            if (flowStep === "categories") {
                return (
                    <div
                        className="h-screen flex items-center justify-center px-4"
                        style={{ background: "#050816" }}
                    >
                        <div className="max-w-4xl w-full scale-in">
                            <div className="grid md:grid-cols-2 gap-6">
                                <div className="rounded-3xl bg-slate-900/90 text-white p-8 shadow-2xl">
                                    <h3 className="text-sm font-semibold text-purple-300 tracking-[0.25em] mb-2">
                                        ADDIM 2
                                    </h3>
                                    <h2 className="text-2xl md:text-3xl font-extrabold mb-6">
                                        Aƒüƒ±llƒ± kateqoriyalar
                                    </h2>
                                    <p className="text-slate-300 text-sm mb-4">
                                        MaliAI x…ôrcl…ôrinizi avtomatik kateqoriyalara b√∂l√ºr v…ô
                                        h…ôr kateqoriya √ºzr…ô x…ôrcl…ôrin payƒ±nƒ± hesablayƒ±r.
                                    </p>

                                    <div className="bg-slate-800/80 rounded-2xl p-4 space-y-3">
                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <span className="text-xl">üì¶</span>
                                                <div>
                                                    <p className="text-sm font-semibold">
                                                        Mal-material x…ôrcl…ôri
                                                    </p>
                                                    <p className="text-xs text-slate-400">COGS</p>
                                                </div>
                                            </div>
                                            <span className="text-xs text-emerald-400 font-semibold">
                                                S√ºr…ôtli artƒ±m
                                            </span>
                                        </div>

                                        <div className="flex items-center justify-between">
                                            <div className="flex items-center gap-3">
                                                <span className="text-xl">üíº</span>
                                                <div>
                                                    <p className="text-sm font-semibold">
                                                        Operativ x…ôrcl…ôr
                                                    </p>
                                                    <p className="text-xs text-slate-400">OPEX</p>
                                                </div>
                                            </div>
                                            <span className="text-xs text-sky-400 font-semibold">
                                                Stabil
                                            </span>
                                        </div>

                                        <div className="flex items-center justify-between bg-indigo-500/30 rounded-xl px-3 py-2 border border-indigo-400/60">
                                            <div className="flex items-center gap-3">
                                                <span className="text-xl">‚ö°</span>
                                                <div>
                                                    <p className="text-sm font-semibold">
                                                        Kommunal x…ôrcl…ôr
                                                    </p>
                                                    <p className="text-xs text-slate-300">
                                                        Se√ßilmi≈ü kateqoriya
                                                    </p>
                                                </div>
                                            </div>
                                            <span className="text-xs text-indigo-100 font-semibold">
                                                CAT
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div className="rounded-3xl bg-slate-900/90 text-white p-8 shadow-2xl">
                                    <h3 className="text-sm font-semibold text-purple-300 tracking-[0.25em] mb-2">
                                        ANALƒ∞Z
                                    </h3>
                                    <h2 className="text-2xl font-extrabold mb-4">
                                        X…ôrcl…ôrin strukturu
                                    </h2>
                                    <p className="text-sm text-slate-300 mb-6">
                                        MaliAI son q…ôbzl…ôriniz…ô …ôsas…ôn x…ôrcl…ôrin b√∂lg√ºs√ºn√º t…ôhlil
                                        edir v…ô hansƒ± istiqam…ôtd…ô optimalla≈üdƒ±rma ed…ô bil…ôc…ôyinizi
                                        m√º…ôyy…ônl…ô≈üdirir.
                                    </p>
                                    <ul className="space-y-2 text-sm text-slate-200">
                                        <li>‚Ä¢ Y√ºkl…ôn…ôn b√ºt√ºn q…ôbzl…ôr sistem…ô tarix, m…ôbl…ôƒü v…ô t…ôchizat√ßƒ± adƒ± daxil edilm…ôkl…ô qeyd olunur.</li>
                                        <li>‚Ä¢ Q…ôbz ≈ü…ôkill…ôrinin keyfiyy…ôti yoxlanƒ±lƒ±r, oxunmayan v…ô ya natamam q…ôbzl…ôrin yenid…ôn y√ºkl…ônm…ôsi t…ôl…ôb olunur.</li>
                                        <li>‚Ä¢ H…ôr bir q…ôbz m√ºvafiq x…ôrc kateqoriyasƒ±na (kommunal, operativ, mal-material v…ô s.) baƒülanƒ±r.</li>
                                        <li>‚Ä¢ Sistem eyni tarix v…ô m…ôbl…ôƒül…ô olan q…ôbzl…ôri dublikat riski baxƒ±mƒ±ndan avtomatik i≈üar…ôl…ôyir.</li>
                                        <li>‚Ä¢ Q…ôbz m…ôlumatlarƒ± aylƒ±q v…ô r√ºbl√ºk maliyy…ô hesabatlarƒ±na inteqrasiya edilir.</li>
                                        <li>‚Ä¢ Y√ºkl…ônmi≈ü q…ôbzl…ôr …ôn azƒ± 5 il m√ºdd…ôtin…ô elektron arxivd…ô saxlanƒ±lƒ±r.</li>
                                        <li>‚Ä¢ N…ôƒüd √∂d…ôni≈ül…ôr √ºzr…ô b√ºt√ºn x…ôrcl…ôr yalnƒ±z uyƒüun q…ôbz t…ôqdim olunduqda sistem…ô daxil edilir.</li>
                                        <li>‚Ä¢ Xarici valyutada olan q…ôbzl…ôr √º√ß√ºn sistem g√ºn√ºn m…ôz…ônn…ôsin…ô …ôsas…ôn avtomatik √ßevirm…ô aparƒ±r.</li>
                                        <li>‚Ä¢ Audit v…ô daxili yoxlamalar zamanƒ± b√ºt√ºn q…ôbzl…ôr sistemd…ôn PDF formatƒ±nda export oluna bilir.</li>
                                        <li>‚Ä¢ Q…ôbz y√ºkl…ôm…ô prosesi √º√ß√ºn m…ôsul ≈ü…ôxsl…ôr v…ô son tarixl…ôr daxili prosedurlarla m√º…ôyy…ôn edilib v…ô izl…ônilir.</li>

                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (flowStep === "export") {
                return (
                    <div
                        className="h-screen flex items-center justify-center px-4"
                        style={{ background: "#050816" }}
                    >
                        <div className="max-w-4xl w-full scale-in glass-dark rounded-3xl p-8 text-white relative">
                            <button
                                onClick={() => {
                                    setFlowStep(null);
                                    setShowResult(true);
                                }}
                                className="absolute top-4 right-4 w-9 h-9 rounded-full bg-slate-800 flex items-center justify-center hover:bg-slate-700 transition-colors"
                            >
                                ‚úï
                            </button>

                            <div className="grid md:grid-cols-3 gap-6">
                                <div className="md:col-span-1">
                                    <h3 className="text-sm font-semibold text-emerald-300 tracking-[0.25em] mb-2">
                                        ADDIM 3
                                    </h3>
                                    <h2 className="text-2xl font-extrabold mb-3">
                                        ƒ∞xrac √º√ß√ºn hazƒ±r
                                    </h2>
                                    <p className="text-sm text-slate-300">
                                        Q…ôbz m…ôlumatlarƒ± yekunla≈üdƒ±. ƒ∞ndi n…ôtic…ôl…ôri
                                        m√ºhasibatlƒ±q sisteml…ôrin…ô ixrac ed…ô bil…ôrsiniz.
                                    </p>
                                </div>

                                <div className="md:col-span-2 bg-slate-900/70 rounded-2xl p-6 space-y-4">
                                    <div className="flex items-center justify-between">
                                        <div>
                                            <p className="text-xs text-slate-400 uppercase mb-1">
                                                T…ôchizat√ßƒ±
                                            </p>
                                            <p className="font-semibold">
                                                {latestReceipt?.vendor || "T…ôchizat√ßƒ±"}
                                            </p>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-xs text-slate-400 uppercase mb-1">
                                                M…ôbl…ôƒü
                                            </p>
                                            <p className="text-xl font-extrabold">
                                                {latestReceipt?.amount || "0.00"}‚Çº
                                            </p>
                                        </div>
                                    </div>

                                    <div className="grid sm:grid-cols-3 gap-3 text-sm text-slate-300">
                                        <div>
                                            <p className="text-xs text-slate-400 uppercase mb-1">
                                                Qaim…ô tarixi
                                            </p>
                                            <p>
                                                {latestReceipt
                                                    ? new Date(latestReceipt.date).toLocaleDateString(
                                                        "az-AZ"
                                                    )
                                                    : "--"}
                                            </p>
                                        </div>
                                        <div>
                                            <p className="text-xs text-slate-400 uppercase mb-1">
                                                ∆èDV (18%)
                                            </p>
                                            <p>Avtomatik hesablanƒ±b</p>
                                        </div>
                                        <div>
                                            <p className="text-xs text-slate-400 uppercase mb-1">
                                                Kateqoriya
                                            </p>
                                            <p>{latestReceipt?.category || "--"}</p>
                                        </div>
                                    </div>

                                    <div className="space-y-3 pt-2">
                                        <button className="w-full py-3 rounded-full bg-emerald-500 hover:bg-emerald-600 text-sm font-semibold">
                                            Excel-…ô ixrac et
                                        </button>
                                        <button className="w-full py-3 rounded-full bg-indigo-500 hover:bg-indigo-600 text-sm font-semibold">
                                            1C-y…ô ixrac et
                                        </button>
                                        <button className="w-full py-3 rounded-full border border-pink-400 text-sm font-semibold text-pink-200">
                                            e-VHF XML yarat
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ---------- RESULT CARD ----------
            if (showResult && latestReceipt) {
                return (
                    <div
                        className={`${isDark ? "bg-slate-900" : "bg-slate-100"
                            } min-h-screen flex items-center justify-center px-4`}
                    >
                        <div className="max-w-md w-full scale-in">
                            <div
                                className={`${isDark ? "glass-dark text-white" : "glass-light text-slate-900"
                                    } rounded-3xl overflow-hidden`}
                            >
                                <div className="gradient-bg-strong p-8 text-center relative overflow-hidden">
                                    <div className="absolute inset-0 opacity-20">
                                        <div className="absolute top-0 right-0 w-32 h-32 bg-white rounded-full blur-2xl"></div>
                                    </div>
                                    <div className="relative z-10">
                                        <div className="w-16 h-16 bg-white/20 rounded-full mx-auto mb-4 flex items-center justify-center backdrop-blur-sm">
                                            <span className="text-3xl">‚úÖ</span>
                                        </div>
                                        <h2 className="text-2xl font-black text-white mb-2">
                                            Uƒüurla Emal Olundu!
                                        </h2>
                                        <p className="text-white/80">
                                            AI G√ºv…ônlik: {latestReceipt.confidence}%
                                        </p>
                                    </div>
                                </div>

                                <div className="p-6 space-y-6">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <p className="text-xs text-slate-500 font-semibold uppercase mb-1">
                                                Vendor
                                            </p>
                                            <h3 className="text-xl font-bold">
                                                {latestReceipt.vendor}
                                            </h3>
                                            <p className="text-sm text-slate-500 mt-1">
                                                {new Date(latestReceipt.date).toLocaleDateString(
                                                    "az-AZ",
                                                    {
                                                        day: "numeric",
                                                        month: "long",
                                                        year: "numeric",
                                                    }
                                                )}
                                            </p>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-xs text-slate-500 font-semibold uppercase mb-1">
                                                M…ôbl…ôƒü
                                            </p>
                                            <p className="text-3xl font-extrabold text-indigo-600">
                                                {latestReceipt.amount}‚Çº
                                            </p>
                                        </div>
                                    </div>

                                    <div className="bg-gradient-to-r from-indigo-50 to-purple-50 rounded-2xl p-4 border border-indigo-100 flex items-center gap-3">
                                        <div className="w-10 h-10 rounded-xl bg-white flex items-center justify-center shadow">
                                            <span className="text-xl">üìä</span>
                                        </div>
                                        <div>
                                            <p className="text-xs text-slate-500 font-semibold uppercase mb-1">
                                                AI Kateqoriya
                                            </p>
                                            <p className="text-sm font-semibold text-slate-900">
                                                {latestReceipt.category}
                                            </p>
                                        </div>
                                    </div>

                                    <div className="space-y-3">
                                        <button
                                            onClick={() => {
                                                setShowResult(false);
                                                setActiveTab("dashboard");
                                            }}
                                            className="w-full py-3 rounded-2xl gradient-bg-strong text-white font-semibold shadow-md active:scale-95 transition-all"
                                        >
                                            Dashboard-a Qayƒ±t
                                        </button>
                                        <button
                                            onClick={() => setShowResult(false)}
                                            className="w-full py-3 rounded-2xl border border-slate-200 text-slate-600 font-medium hover:bg-slate-50"
                                        >
                                            D√ºz…ôli≈ü et
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // ---------- MAIN DASHBOARD ----------
            return (
                <div
                    className={`min-h-screen flex flex-col pb-24 ${isDark ? "bg-slate-900" : "bg-slate-50"
                        }`}
                >
                    {/* Top header */}
                    <header
                        className={`${isDark ? "bg-slate-950" : "bg-white"
                            } shadow-md px-4 sm:px-6 py-4 flex items-center justify-between`}
                    >
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 rounded-2xl bg-gradient-to-tr from-purple-500 to-indigo-500 flex items-center justify-center text-white shadow-lg">
                                <span className="text-xl">üíº</span>
                            </div>
                            <div>
                                <p
                                    className={`text-xs font-semibold tracking-[0.25em] uppercase ${isDark ? "text-slate-400" : "text-slate-500"
                                        }`}
                                >
                                    MaliAI Dashboard
                                </p>
                                <p
                                    className={`text-sm font-semibold ${isDark ? "text-white" : "text-slate-900"
                                        }`}
                                >
                                    Salam, {user?.name || "istifad…ô√ßi"}
                                </p>
                                <p
                                    className={`text-xs ${isDark ? "text-slate-400" : "text-slate-500"
                                        }`}
                                >
                                    {user?.business || "Biznesiniz"}
                                </p>
                            </div>
                        </div>

                        <div className="flex items-center gap-3">
                            <button
                                onClick={toggleTheme}
                                className={`${isDark ? "bg-slate-800 text-yellow-300" : "bg-slate-100 text-slate-700"
                                    } w-10 h-10 rounded-2xl flex items-center justify-center shadow-md active:scale-95 transition-all`}
                                title="Dark / Light"
                            >
                                {isDark ? "üåô" : "‚òÄÔ∏è"}
                            </button>

                            <button
                                onClick={() => {
                                    setUser(null);
                                    setView("login");
                                }}
                                className="px-4 h-10 rounded-2xl bg-slate-900 text-white text-sm font-semibold flex items-center gap-2 shadow-lg"
                            >
                                <span>√áƒ±xƒ±≈ü</span>
                            </button>
                        </div>
                    </header>

                    {/* Summary strip */}
                    <section className="px-4 sm:px-6 pt-4">
                        <div className="gradient-bg rounded-3xl p-6 text-white shadow-xl flex flex-col sm:flex-row sm:items-end sm:justify-between gap-4">
                            <div>
                                <p className="text-sm text-white/80 mb-1">√úmumi X…ôrc (bu ay)</p>
                                <p className="text-4xl font-extrabold leading-none">
                                    {totalExpense.toFixed(2)}‚Çº
                                </p>
                            </div>
                            <div className="flex gap-6 text-sm">
                                <div>
                                    <p className="text-xs text-white/80 mb-1">Q…ôbzl…ôr</p>
                                    <p className="text-xl font-semibold">{receipts.length}</p>
                                </div>
                                <div>
                                    <p className="text-xs text-white/80 mb-1">Kateqoriya</p>
                                    <p className="text-xl font-semibold">
                                        {new Set(receipts.map((r) => r.category)).size}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </section>

                    {/* Main content */}
                    <main className="flex-1 px-4 sm:px-6 pt-6 space-y-6">
                        {activeTab === "dashboard" && (
                            <>
                                {/* Upload card */}
                                <section>
                                    <div
                                        className={`${isDark ? "glass-dark text-white" : "glass-light text-slate-900"
                                            } rounded-3xl p-6 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-6`}
                                    >
                                        <div>
                                            <p className="text-xs tracking-[0.25em] uppercase text-slate-400 mb-2">
                                                MaliAI
                                            </p>
                                            <h2 className="text-lg font-bold mb-1">
                                                Q…ôbzl…ôrinizi y√ºkl…ôyin
                                            </h2>
                                            <p
                                                className={`text-sm ${isDark ? "text-slate-300" : "text-slate-500"
                                                    }`}
                                            >
                                                S…ôn…ôdl…ôrinizi skan edin, MaliAI qalan i≈üi AI il…ô h…ôll
                                                etsin.
                                            </p>

                                            <div className="flex gap-4 mt-4 text-center text-xs">
                                                <div>
                                                    <p className="text-slate-400 mb-1">S…ôn…ôd</p>
                                                    <p className="text-lg font-semibold">
                                                        {receipts.length}
                                                    </p>
                                                </div>
                                                <div>
                                                    <p className="text-slate-400 mb-1">Vaxt</p>
                                                    <p className="text-lg font-semibold">12h</p>
                                                </div>
                                                <div>
                                                    <p className="text-slate-400 mb-1">D…ôqiqlik</p>
                                                    <p className="text-lg font-semibold">98%</p>
                                                </div>
                                            </div>

                                            <button
                                                onClick={() => fileInputRef.current?.click()}
                                                className="mt-5 w-full sm:w-auto px-6 py-3 rounded-2xl gradient-bg-strong text-white font-semibold shadow-lg active:scale-95 transition-all flex items-center justify-center gap-2"
                                            >
                                                <span>üì∑</span>
                                                <span>Q…ôbzi skan et</span>
                                            </button>
                                        </div>
                                    </div>
                                </section>

                                {/* Recent */}
                                <section>
                                    <h3
                                        className={`text-base font-semibold mb-3 ${isDark ? "text-white" : "text-slate-900"
                                            }`}
                                    >
                                        Son …ôm…ôliyyatlar
                                    </h3>

                                    {receipts.length === 0 ? (
                                        <div
                                            className={`${isDark ? "glass-dark text-slate-300" : "glass-light text-slate-600"
                                                } rounded-3xl p-8 text-center`}
                                        >
                                            <div className="w-16 h-16 rounded-full bg-slate-100 mx-auto mb-4 flex items-center justify-center">
                                                <span className="text-3xl">üì∏</span>
                                            </div>
                                            <p className="mb-4">H…ôl…ô q…ôbz yoxdur</p>
                                            <button
                                                onClick={() => fileInputRef.current?.click()}
                                                className="px-6 py-3 rounded-2xl gradient-bg-strong text-white font-semibold shadow-lg active:scale-95 transition-all"
                                            >
                                                ƒ∞lk q…ôbzi skan et
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="space-y-3">
                                            {receipts.map((r) => (
                                                <div
                                                    key={r.id}
                                                    className={`${isDark ? "bg-slate-900/80 text-white" : "bg-white text-slate-900"
                                                        } rounded-2xl p-4 shadow flex items-center gap-3`}
                                                >
                                                    <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-purple-100 to-indigo-100 flex items-center justify-center flex-shrink-0">
                                                        <span className="text-2xl">üìÑ</span>
                                                    </div>
                                                    <div className="flex-1 min-w-0">
                                                        <p className="font-semibold truncate">
                                                            {r.vendor}
                                                        </p>
                                                        <p
                                                            className={`text-xs ${isDark ? "text-slate-300" : "text-slate-500"
                                                                }`}
                                                        >
                                                            {r.category}
                                                        </p>
                                                        <p className="text-xs text-slate-400">
                                                            {new Date(r.date).toLocaleDateString("az-AZ", {
                                                                day: "numeric",
                                                                month: "short",
                                                            })}
                                                        </p>
                                                    </div>
                                                    <div className="text-right">
                                                        <p className="font-semibold">{r.amount}‚Çº</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </section>
                            </>
                        )}

                        {activeTab === "chat" && (
                            <section className="flex flex-col h-[calc(100vh-220px)]">
                                <div className="flex-1 overflow-y-auto space-y-4 mb-4">
                                    {/* Intro AI bubble */}
                                    <div
                                        className={`${isDark ? "bg-slate-900/80 text-slate-50" : "bg-white text-slate-800"
                                            } rounded-2xl p-4 shadow`}
                                    >
                                        <div className="flex items-start gap-3">
                                            <div className="w-8 h-8 rounded-xl bg-gradient-to-br from-purple-500 to-indigo-500 flex items-center justify-center text-white flex-shrink-0">
                                                ü§ñ
                                            </div>
                                            <p className="text-sm leading-relaxed">
                                                Salam! M…ôn sizin AI maliyy…ô m…ôsl…ôh…ôt√ßiniz…ôm. B√ºdc…ô,
                                                x…ôrcl…ôr v…ô kredit haqqƒ±nda suallarƒ±nƒ±zƒ± ver…ô
                                                bil…ôrsiniz. Y√ºkl…ôdiyiniz q…ôbzl…ôr…ô …ôsaslanaraq siz…ô
                                                daha d…ôqiq t√∂vsiy…ôl…ôr ver…ôc…ôy…ôm.
                                            </p>
                                        </div>
                                    </div>

                                    {chatMessages.map((msg, idx) => (
                                        <div
                                            key={idx}
                                            className={`flex ${msg.role === "user"
                                                ? "justify-end"
                                                : "justify-start"
                                                }`}
                                        >
                                            <div
                                                className={`max-w-[80%] rounded-2xl px-4 py-3 text-sm leading-relaxed shadow ${msg.role === "user"
                                                    ? "bg-gradient-to-br from-indigo-500 to-purple-500 text-white"
                                                    : isDark
                                                        ? "bg-slate-900/85 text-slate-50"
                                                        : "bg-white text-slate-800"
                                                    }`}
                                            >
                                                {msg.content}
                                            </div>
                                        </div>
                                    ))}
                                    <div ref={chatEndRef} />
                                </div>

                                <div
                                    className={`${isDark ? "bg-slate-900/90" : "bg-white"
                                        } rounded-2xl p-2 shadow flex items-center gap-2`}
                                >
                                    <input
                                        value={chatInput}
                                        onChange={(e) => setChatInput(e.target.value)}
                                        onKeyDown={(e) => e.key === "Enter" && sendMessage()}
                                        placeholder="Sualƒ±nƒ±zƒ± yazƒ±n..."
                                        className="flex-1 px-3 py-2 bg-transparent focus:outline-none text-sm"
                                    />
                                    <button
                                        onClick={sendMessage}
                                        className="w-10 h-10 rounded-xl gradient-bg-strong text-white flex items-center justify-center active:scale-95 transition-all"
                                    >
                                        ‚û§
                                    </button>
                                </div>
                            </section>
                        )}
                    </main>

                    {/* Bottom nav */}
                    <nav
                        className={`${isDark ? "bg-slate-950" : "bg-white"
                            } fixed bottom-0 left-0 right-0 border-t border-slate-200/60 px-6 py-3 flex items-center justify-around`}
                    >
                        <button
                            onClick={() => setActiveTab("dashboard")}
                            className={`flex flex-col items-center gap-0.5 text-xs ${activeTab === "dashboard"
                                ? "text-purple-600"
                                : "text-slate-400"
                                }`}
                        >
                            <span>üè†</span>
                            <span>Ana s…ôhif…ô</span>
                        </button>

                        <button
                            onClick={() => fileInputRef.current?.click()}
                            className="w-14 h-14 -mt-8 rounded-full gradient-bg-strong text-white flex items-center justify-center shadow-2xl active:scale-95 transition-all"
                        >
                            üì∑
                        </button>

                        <button
                            onClick={() => setActiveTab("chat")}
                            className={`flex flex-col items-center gap-0.5 text-xs ${activeTab === "chat"
                                ? "text-purple-600"
                                : "text-slate-400"
                                }`}
                        >
                            <span>üí¨</span>
                            <span>AI Chat</span>
                        </button>
                    </nav>

                    <input
                        ref={fileInputRef}
                        type="file"
                        accept="image/*"
                        onChange={handleFileUpload}
                        className="hidden"
                    />
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
</body>

</html>